<?xml version="1.0" encoding="UTF-8"?>
<!-- Configuration for Apache Ant. -->
<project name="agora" default="regenerate-all" basedir=".">

	<!-- Project configuration -->
	<property name="doc" value="doc"/>
	<property name="php-documentation" value="${doc}/code"/>
	<property name="php-doxyfile" value="dev/Doxyfile" />
	<property name="coverage-report" value="${doc}/coverage"/>
	<property name="tests-location" value="tests/phpunit"/>

	<!-- Build all automatically generated files -->
	<target name="regenerate-all" depends="clean,test,doc-php">
		<!-- Dependencies do anything we need here -->
	</target>
	
	<!-- Delete all automatically generated files -->
	<target name="clean">
		<echo message="Clearing PHP old autogenerated content…"/>
		<!-- Remove old code coverage report -->
		<delete dir="${coverage-report}"/>
		<!-- Remove old PHP documentation -->
		<delete dir="${php-documentation}"/>
	</target>

	<!-- Make PHP unit tests -->
	<target name="test">
		<echo message="Running PHP unit tests…"/>
		<!-- Create coverage report directory -->
		<mkdir dir="${coverage-report}"/>
		<!-- Run tests -->
		<exec executable="phpunit">
			<arg value="--coverage-html" />
			<arg value="${coverage-report}" />
			<arg value="${tests-location}" />
		</exec>
	</target>
	
	<!-- Build PHP documentation -->
	<target name="doc-php">
		<echo message="Building PHP documentation…"/>
		<!-- Build documentation -->
		<exec executable="doxygen">
			<arg value="${php-doxyfile}" />
		</exec>
	</target>
	
</project>
