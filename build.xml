<?xml version="1.0" encoding="UTF-8"?>
<!-- Configuration for Apache Ant. -->
<project name="agora" default="all" basedir=".">

	<!-- Project configuration -->
	<property name="doc-dir" value="doc"/>
	<!-- PHP -->
	<property name="php-doc-dir" value="${doc-dir}/php"/>
	<property name="php-doxyfile" value="dev/Doxyfile" />
	<property name="php-coverage-dir" value="${doc-dir}/coverage"/>
	<property name="php-tests-location" value="tests"/>
	<!-- JS -->
	<property name="js-src" value="front/src"/>
	<property name="js-doc-dir" value="${doc-dir}/js"/>

	<!-- Build all automatically generated files -->
	<target name="all" depends="clean,test-php,doc">
		<!-- Dependencies do anything we need here -->
	</target>
	
	<!-- Delete all automatically generated files -->
	<target name="clean">
		<echo message="Clearing old autogenerated content…"/>
		<!-- Remove old code coverage report -->
		<delete dir="${php-coverage-dir}"/>
		<!-- Remove old PHP documentation -->
		<delete dir="${php-doc-dir}"/>
		<!-- Remove old JS documentation -->
		<delete dir="${js-doc-dir}"/>
	</target>

	<!-- Make PHP unit tests -->
	<target name="test-php">
		<echo message="Running PHP unit tests…"/>
		<!-- Create coverage report directory ->
		<mkdir dir="${php-coverage-dir}"/>-->
		<!-- Run tests -->
		<exec executable="phpunit">
			<arg value="--coverage-html" /> <arg value="${php-coverage-dir}" />
			<arg value="--test-suffix" /> <arg value="Test.php" />
			<arg value="--process-isolation" />
			<!--<arg value="&#34;-stop-on-failure" />-->
			<arg value="${php-tests-location}" />
		</exec>
	</target>
	
	<!-- Build all documentation -->
	<target name="doc" depends="doc-php,doc-js">
		<!-- Dependencies do anything we need here -->
	</target>
	
	<!-- Build PHP documentation -->
	<target name="doc-php">
		<echo message="Building PHP documentation…"/>
		<!-- Build documentation -->
		<exec executable="doxygen">
			<arg value="${php-doxyfile}" />
		</exec>
	</target>
	
	<!-- Build JS documentation -->
	<target name="doc-js">
		<echo message="Building JS documentation…"/>
		<!-- Build documentation -->
		<exec executable="jsduck">
			<arg value="-v" />
			<arg value="${js-src}" />
			<arg value="-o" /> <arg value="${js-doc-dir}" />
		</exec>
	</target>
	
</project>
